document.addEventListener("DOMContentLoaded",async function(){const h=150,k=2e3,t=new PIXI.Application({resizeTo:document.getElementById("pixi-container"),backgroundAlpha:1,resolution:1,autoDensity:!0,antialias:!0,powerPreference:"high-performance"}),n=document.getElementById("pixi-container");n.appendChild(t.view),window.addEventListener("resize",()=>{t.renderer.resize(n.clientWidth,n.clientHeight)}),t.renderer.resize(n.clientWidth,n.clientHeight);function r(e,n){const s=new PIXI.Graphics;return s.beginFill(n,1),s.drawCircle(0,0,e),s.endFill(),t.renderer.generateTexture(s)}const C=r(10,13382451),x=r(10,0);class O{constructor(e,t,n,s,o){this.x=e,this.y=t,this.radius=10,this.activated=!1,this.label=n,this.textureActive=s,this.textureInactive=o,this.sprite=new PIXI.Sprite(this.textureInactive),this.text=new PIXI.Text(n,{fontSize:12,fill:16777215,align:"center"}),this.sprite.anchor.set(.5),this.updatePosition()}activate(){this.activated=!0,this.sprite.texture=this.textureActive,console.log(`Node ${this.label} activated at (${this.x}, ${this.y})`)}deactivate(){this.activated=!1,this.sprite.texture=this.textureInactive,console.log(`Node ${this.label} deactivated at (${this.x}, ${this.y})`)}updatePosition(){this.sprite.x=this.x,this.sprite.y=this.y,this.text.x=this.x-this.radius,this.text.y=this.y-this.radius-15}}function d(e,n){const s=new PIXI.Graphics;return s.lineStyle(e,n,1),s.moveTo(0,0),s.lineTo(100,0),t.renderer.generateTexture(s)}const w=d(2,16711680),b=d(1,0);class y{constructor(e,t,n,s){this.node1=e,this.node2=t,this.activated=!1,this.textureActive=n,this.textureInactive=s,this.sprite=new PIXI.Sprite(this.textureInactive),this.sprite.anchor.set(0,.5),this.updateGraphics()}activate(){this.activated=!0,this.sprite.texture=this.textureActive,console.log(`Edge from ${this.node1.label} to ${this.node2.label} activated`)}deactivate(){this.activated=!1,this.sprite.texture=this.textureInactive,console.log(`Edge from ${this.node1.label} to ${this.node2.label} deactivated`)}updateGraphics(){const e=this.node2.x-this.node1.x,t=this.node2.y-this.node1.y,n=Math.sqrt(e*e+t*t);this.sprite.width=n,this.sprite.rotation=Math.atan2(t,e),this.sprite.x=this.node1.x,this.sprite.y=this.node1.y}}let a=[],s=[];function m(e,n,s){let o=new O(e,n,s,C,x);return console.log(`Creating node at (${e}, ${n}) with label ${s}`),a.push(o),t.stage.addChild(o.sprite),t.stage.addChild(o.text),o}function p(e,n){let o=new y(e,n,w,b);console.log(`Creating edge from ${e.label} to ${n.label}`),s.push(o),t.stage.addChild(o.sprite)}function g(){const e=window.innerWidth;return e<640?5:Math.min(20,Math.floor((e-640)/64)+6)}const v=g(),o=Array.from({length:v},()=>Math.floor(Math.random()*10)+2),j=o.map((e,t)=>Array.from({length:e},(e,n)=>`L${t+1}N${n+1}`)),f=t.screen.width/(o.length+1),_=(e,t)=>e/(t+1);o.forEach((e,n)=>{const s=(n+1)*f,o=_(t.screen.height,e);for(let t=0;t<e;t++){const i=(t+1)*o;m(s,i,j[n][t])}});const e=[];let i=0;o.forEach(t=>{const n=a.slice(i,i+t);e.push(n),i+=t});for(let t=0;t<e.length-1;t++)e[t].forEach(n=>{e[t+1].forEach(e=>{p(n,e)})});function l(t){if(t>=e.length)return;c(t-1),e[t].forEach(e=>{Math.random()>.5?e.activate():e.deactivate()}),t<e.length-1&&e[t].forEach(n=>{n.activated&&e[t+1].forEach(e=>{s.forEach(t=>{t.node1===n&&t.node2===e&&(t.activate(),e.activate())})})}),setTimeout(()=>l(t+1),h)}function c(t){if(t<0)return;e[t].forEach(e=>e.deactivate()),s.forEach(n=>{e[t].includes(n.node1)&&n.deactivate()})}function E(){let t=0;function n(){t===0&&e.length>0&&c(e.length-1),t>=e.length?(t=0,setTimeout(n,k)):(l(t),t++,setTimeout(n,h))}n()}function u(){a.forEach(e=>{e.updatePosition()}),s.forEach(e=>{e.updateGraphics()}),t.renderer.render(t.stage),requestAnimationFrame(u)}requestAnimationFrame(u),E()})